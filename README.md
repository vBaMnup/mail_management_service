# Сервис управления рассылками
### Задача
Необходимо разработать сервис управления рассылками.

### Описание
Необходимо реализовать методы создания новой рассылки и просмотр 
созданных рассылок.

### Критерии приёмки
- Выполненное задание необходимо разместить в публичном репозитории на github;
- Необходимо использовать Docker для запуска приложения;
- Коллекция Postman для проверки API.

### Основное задание
Спроектировать и разработать сервис, который по заданным правилам запускает 
рассылку по списку клиентов.
Сущность "рассылка" имеет атрибуты:
- уникальный id рассылки;
- дата и время запуска рассылки;
- фильтр свойств клиентов, на которых должна быть произведена рассылка 
(код мобильного оператора, тег);
- дата и время окончания рассылки: если по каким-то причинам не успели 
разослать все сообщения - никакие сообщения клиентам после этого времени 
доставляться не должны

Сущность "клиент" имеет атрибуты:
- уникальный id клиента
- номер телефона клиента в формате 7XXXXXXXXXX (X - цифра от 0 до 9)
- код мобильного оператора
- тег (произвольная метка)
Сущность "сообщение" имеет атрибуты:
- уникальный id сообщения
- дата и время создания (отправки)
- id рассылки, в рамках которой было отправлено сообщение
- текст сообщения.

### Логика рассылки
- После создания новой рассылки, если текущее время больше времени начала и 
меньше времени окончания - должны быть выбраны из справочника все клиенты, 
которые подходят под значения фильтра, указанного в этой рассылке и запущена 
отправка для всех этих клиентов. Для отправки нужно использовать объект 
сообщения, который прикреплен к рассылке.
- Если создаётся рассылка с временем старта в будущем - отправка должна 
стартовать автоматически по наступлению этого времени без дополнительных 
действий со стороны пользователя системы.

Сообщения рассылки можно выводить в консоль приложения.

### Технологии
- python 3.11
- Django 4.2.3
- Django Rest Framework 3.14.0
- PostgreSQL 13.0
- Celery
- Redis
- Black
- Dotenv

### Как запустить проект

Клонировать репозиторий и перейти в него в командной строке:

 ```bash
 git clone git@github.com:vBaMnup/mail_management_service.git 
 ```

Добавить в файл .env:
```bash
cd config/
touch .env
```
```dotenv
SECRET_KEY="django-insecure-k25cy#!ywppx_beguz6u@*5#)$m)bk52!3x803u4($zw#sry8h"
CELERY_BROKER_URL=redis://redis:6379
CELERY_RESULT_BACKEND=redis://redis:6379
DB_NAME=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432
```

Выполнить файл docker-compose.yml:

```bash
docker-compose up -d --build
```

Ссылка на документацию:
```url
http://localhost:8000/docs/
```

Коллекция Postman для проверки API доступна в файле:
```text
mail_management_service.postman_collection.json
```

Посмотреть лог отправки сообщений в рассылке
```bash
docker-compose logs -f celery
```

### Автор
[Paskov Andrey](https://t.me/vbamnup)